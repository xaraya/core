<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
  <title>Code Review Checklist v0.2</title>
  <style type="text/css">
   table { border-collapse: collapse; }
   td { 
     border-left: 1px solid grey;
     border-top: 1px dotted grey;
     padding: 2px;
     vertical-align: top;
   }
   td:first-child { border-left: none; }
   tr:first-child td { border-top: none; }

   @media print {
      div#blurb { display: none; }
      @page { size: landscape; }
   }
   html { background: navy; }
   body {
      margin: 0px 0px 0px 30px;
      padding: 4px;
      background: white;
      border-left: 1px solid #000071;
   }
   h1 { color: navy; margin: 2px; }
   h2 { color: #6868a8; border-bottom: 1px solid #ccc; }
   h3 { color: #6868a8; }
   h4 { color: #6868a8; }
  </style>
</head>
<body>
<h1>Xaraya Code Review Checklist v0.2.1</h1>
<div id="blurb">
<h2>Using this checklist</h2>
The idea of having this code review checklist is that it makes you stop
and think about the code you have just written, and all the possible
defects it contains. Engineers typically inject about 100 defects per
1000 lines of code, thats 1 defect for every 10 lines of code.
Effective code reviews can locate as many as 75% of these defects and
at a rate 3 to 4 times faster than during testing [1].<br>
<br>
Code reviews have to be done properly to be of any use, so take the
time it takes; print this checklist and then print the code you have
just written. The unix tool 'a2ps' is excellent for printing source
code and is also available under cygwin. An excellent way to start is
to highlight the items in the list that are most relevant to your code
and cross off those that are not relevant at all. <br>
<br>
The checklist has to be used <span style="font-style: italic;">before</span>
you start testing though!<br>
<br>
Items marked with an entry under "BK" have automatic tests as a part of
the `<span style="font-family: monospace;">bk
qachecks</span>'&nbsp; tool and can be run from the command line when
you
have the qachecks script checked out of the bitkeeper repository:<br>
<pre>&nbsp;$ bk clone <i class="moz-txt-slash"><span class="moz-txt-tag">http://www.xaraya.com:15000/stable</span><span
 class="moz-txt-tag"></span></i><br>&nbsp;$ cd stable/BitKeeper/custom<br>&nbsp;$ bk -r. get<br>&nbsp;$ cd ../../html/includes<br>&nbsp;$ bk qachecks<br></pre>
A 'Req' entry means that you cannot push code to the repository unless
you satisfy this condition. An 'Opt' entry means this condition is not
tested by the bk server, but can still be checked using<br>
<pre>&nbsp;$ bk qachecks -all</pre>
Entries marked ? are possible candidates to be added to the qachecks
script.<br>
<br>
[1] These statistics from <span style="font-style: italic;">Introduction
to the Personal Software Process</span> by Watts S Humphrey
(Addison-Wesley 1997).<br>
</div>
<h2>1 Code statistics<br>
</h2>
<pre>                      Date ___________<br>                  Reviewer ______________________<br>                    Author ______________________<br>                      File ______________________<br>              File Version ___________<br>                LOC(total) ______<br>             LOC(comments) ______<br>                LOC(blank) ______<br> comments:non-blank ratio: ______<br></pre>
<h2>2 Common Xaraya Errors</h2>
<table border="1">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);"><span
 style="font-weight: bold;">BK</span><br>
      </td>
      <td
 style="vertical-align: top; text-align: center; background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);">#<br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; text-align: center; background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);">Description<br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; text-align: center; background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);">Explanation<br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">2.1<br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">API</span><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">2.1.1<br>
      </td>
      <td style="vertical-align: top;">Parameters for GUI functions are
retrieved correctly using <span style="font-family: monospace;">xarVarFetch</span><br>
      </td>
      <td style="vertical-align: top;">Important notes about <span
 style="font-family: monospace;">xarVarFetch</span>:<br>
      <pre>function <span class="function">xarVarFetch</span><br>    (<span
 class="var">$name</span>, <span class="var">$validation</span>, &amp;<span
 class="var">$value</span>, <span class="var">$defaultValue</span>, <span
 class="var">$flags</span>, <span class="var">$prep</span>)</pre>
      <span class="comment">The <span style="font-family: monospace;">$flag</span>
parameter is a bitmask between the following constants: <span
 style="font-family: monospace;"><br>
      <span style="font-family: monospace;">&nbsp; XARVAR_GET_OR_POST</span></span><br
 style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp; XARVAR_GET_ONLY</span></span><span
 style="font-family: monospace;"><br>
&nbsp; </span><span class="comment" style="font-family: monospace;">XARVAR_POST_ONLY<br>
&nbsp; XARVAR_NOT_REQUIRED&nbsp; don't throw an exception<br>
&nbsp; </span><span style="font-family: monospace;" class="comment"><span
 class="comment"><span style="font-family: monospace;">XARVAR_DONT_REUSE&nbsp;&nbsp;&nbsp;
always modify the existing $value</span></span></span><br>
      <span style="font-family: monospace;">&nbsp;
XARVAR_DONT_SET&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; don't ever modify the
existing $value<br>
      </span></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">2.1.2<br>
      </td>
      <td style="vertical-align: top;">Correctly handle return value
for <span style="font-family: monospace;">xarVarFetch</span><br>
      </td>
      <td style="vertical-align: top;"><span
 style="font-family: monospace;">xarVarFetch</span> will return false
if a validation fails and the default value was subsituted.<br>
      </td>
    </tr>
    <tr>
      <td>Req?<br>
      </td>
      <td>2.1.3<br>
      </td>
      <td>All functions called using <tt>xarModAPIFunc()</tt>?</td>
      <td><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">2.1.4<br>
      </td>
      <td style="vertical-align: top;">Return values from API functions<br>
      </td>
      <td style="vertical-align: top;"><span style="font-style: italic;">TODO:
there is a thread started by Marcel (17 Feb 04) 'Some API notes' which
discusses this, although ATM I don't believe we have any guidelines set
in place.</span><br>
      </td>
    </tr>
    <tr>
      <td>Req<br>
      </td>
      <td>2.1.5<br>
      </td>
      <td>No use of <span style="font-family: monospace;">die()</span>
or <span style="font-family: monospace;">exit()</span>.</td>
      <td>Xaraya handles script finishing and clean up.<code><span
 style="font-style: italic;"><br>
      </span></code></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">2.2<br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">Input
handling<br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">2.2.1<br>
      </td>
      <td style="vertical-align: top;">Correct parameters in exception
messages.<br>
      </td>
      <td style="vertical-align: top;">Often, when you cut and paste
exception messages from other modules, they will contain text like "<span
 style="font-family: monospace;">Invalid parameters for admin function
foo in module bar</span>". Make sure '<span
 style="font-family: monospace;">admin</span>', '<span
 style="font-family: monospace;">foo</span>', and '<span
 style="font-family: monospace;">bar</span>' are passed correctly.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">2.2.2<br>
      </td>
      <td style="vertical-align: top;">GUI functions should also `<span
 style="font-family: monospace;">extract $args;</span>'<br>
      </td>
      <td style="vertical-align: top;"><span style="font-style: italic;"></span>Even
GUI functions need to extract values from <span
 style="font-family: monospace;">$args</span>, since these can be
provided in templates. The recommended method is to extract them after <span
 style="font-family: monospace;">xarVarFetch</span> so that the <span
 style="font-family: monospace;">$args</span> values overwrite <span
 style="font-family: monospace;">REQUEST</span> values.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">2.2.3<br>
      </td>
      <td style="vertical-align: top;">Check for required variables in
functions.<br>
      </td>
      <td style="vertical-align: top;">The first thing that must be
done is to check that required variables passed into a function are set
and valid.<br>
      </td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>2.2.4<br>
      </td>
      <td>Checkboxes from cgi input have an <code><br>
      <br>
&nbsp; if
(empty($checkbox_name)) { $checkbox_name = false; }</code></td>
      <td>Some browsers may not send a value for a checkbox input
variable when it is not checked.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">2.2.5<br>
      </td>
      <td style="vertical-align: top;">Input variables correctly
validated<br>
      </td>
      <td style="vertical-align: top;">Available validations are found
in includes/validations. At the time of writing this is:<br>
      <span style="font-family: monospace;">array, bool, checkbox,
email,
enum, float, fullemail, html, id, int, isset, keylist, list, mxcheck,
notempty, pre, regexp, str, strlist </span>. See the phpdoc for more
details of each.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">2.3<br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">Output
handling<br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">2.3.1<br>
      </td>
      <td style="vertical-align: top;"><span
 style="font-weight: bold; font-style: italic;">All </span>output
filtered through <span style="font-family: monospace;">xarVarPrepForDisplay()</span>.<br>
      </td>
      <td style="vertical-align: top;">This prevents attacks like the
insertion of <span style="font-family: monospace;">&lt;script&gt;</span>
and <span style="font-family: monospace;">&lt;iframe&gt;</span> tags
into variables which are then displayed to the user.<br>
      </td>
    </tr>
    <tr>
      <td>Req<br>
      </td>
      <td>2.3.2<br>
      </td>
      <td>No output generation.</td>
      <td>All output in Xaraya is handled by the core. Don't use <span
 style="font-family: monospace;">echo</span> or <span
 style="font-family: monospace;">print</span>, if you need debugging
you can use <span style="font-family: monospace;">xarLogMessage()</span>.</td>
    </tr>
    <tr>
      <td>Opt?<br>
      </td>
      <td>2.3.3<br>
      </td>
      <td>No non-templated output.</td>
      <td>All output from blocks and modules must be done through
templates, not hard coded in php source files.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Req?<br>
      </td>
      <td style="vertical-align: top;">2.3.4<br>
      </td>
      <td style="vertical-align: top;">All php files begin with <span
 style="font-family: monospace;">&lt;?php</span> end in <span
 style="font-family: monospace;">?&gt;</span><br>
      </td>
      <td style="vertical-align: top;">Xaraya does not allow output
outside of php tags.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">2.4</span><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">Deprecated
Code</span><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Req<br>
      </td>
      <td style="vertical-align: top;">2.4.1<br>
      </td>
      <td style="vertical-align: top;">No use of deprecated Xaraya
functions.<br>
      </td>
      <td style="vertical-align: top;">The list of deprecated functions
is maintained in the <span style="font-family: monospace;">qachecks</span>
script. Commonly used deprecated functions are <span
 style="font-family: monospace;">xarVarPrepForStore</span> and <span
 style="font-family: monospace;">xarVarCleanFromInput</span>.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Req*<br>
Opt<br>
      </td>
      <td style="vertical-align: top;">2.4.2<br>
      </td>
      <td style="vertical-align: top;">No use of legacy functions.<br>
      </td>
      <td style="vertical-align: top;">These functions are only there
to help port modules from other CMS systems. The list of legacy
functions is maintained in the <span style="font-family: monospace;">qachecks</span>
script.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Req?<br>
      </td>
      <td style="vertical-align: top;">2.4.3<br>
      </td>
      <td style="vertical-align: top;"><span
 style="font-family: monospace;">xarDBGetConn()</span> no longer
returns an array.<br>
      </td>
      <td style="vertical-align: top;">Correct usage looks like this:<br>
      <pre>   $dbconn =&amp; xarDBGetConn();</pre>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Req?<br>
      </td>
      <td style="vertical-align: top;">2.4.4<br>
      </td>
      <td style="vertical-align: top;">Only php 4.1.2 functions used.<br>
      </td>
      <td style="vertical-align: top;">Xaraya currently supports php
4.1.2<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">2.4.5<br>
      </td>
      <td style="vertical-align: top;"><span
 style="font-family: monospace;">&lt;comment&gt;</span> tags are now <span
 style="font-family: monospace;">&lt;xar:comment&gt;</span><br>
      </td>
      <td style="vertical-align: top;"><span style="font-style: italic;">Not
sure if I made this up of if it is a real problem.</span><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">2.5</span><br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">Exception
Handling<br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">2.6</span><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">Other</span><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td>Opt<br>
      </td>
      <td>2.6.1<br>
      </td>
      <td>Use <tt>xarInclude</tt> in preference of the php equivalent.</td>
      <td><code><br>
      </code></td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>2.6.1<br>
      </td>
      <td>Static texts are all correctly translated.</td>
      <td>All output text should be translated using <span
 style="font-family: monospace;">xarML()</span><br>
      </td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>2.6.2<br>
      </td>
      <td>Hooks are programmed in the correct direction.</td>
      <td><span style="font-style: italic;">TODO: I know what this
means, but
don't no how to explain it with an example.</span><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">2.6.3<br>
      </td>
      <td style="vertical-align: top;">All installed masks, instances,
dynamic data objects and module variables removed.<br>
      </td>
      <td style="vertical-align: top;">This is only relevant to the <span
 style="font-family: monospace;">*_delete()</span> function in <span
 style="font-family: monospace;">xarinit.php</span>.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<h2><span style="font-weight: bold;"></span>3 Common PHP Errors</h2>
<table border="1">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);"><span
 style="font-weight: bold;">BK</span><br>
      </td>
      <th
 style="background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);">#</th>
      <th
 style="background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);">Description</th>
      <th style="background-color: rgb(51, 0, 153);"><span
 style="color: rgb(255, 255, 255);">Explanation</span><br>
      </th>
    </tr>
    <tr>
      <td style="background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="font-weight: bold; background-color: rgb(204, 204, 255);">3.1<br>
      </td>
      <td
 style="font-weight: bold; background-color: rgb(204, 204, 255);">Syntax
Errors<br>
      </td>
      <td style="background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td>Req<br>
      </td>
      <td>3.1.1<br>
      </td>
      <td>All <span style="font-family: monospace;">&lt;?</span><a
 href="http://www.php.net" title="PHP"
 style="text-decoration: none; font-family: monospace;">php</a> tags
have a closing <span style="font-family: monospace;">?&gt;</span> tag.</td>
      <td><code><br>
      </code></td>
    </tr>
    <tr>
      <td>Opt<br>
      </td>
      <td>3.1.2<br>
      </td>
      <td>Use <span style="font-family: monospace;">=</span> for
assignment, <span style="font-family: monospace;">==</span> for
equality comparison.</td>
      <td>A common error is to forget an = sign in a conditional.<br>
      </td>
    </tr>
    <tr>
      <td>Req<br>
      </td>
      <td>3.1.3<br>
      </td>
      <td>Number of parenthesis match in if/while/switch etc.</td>
      <td><code><br>
      </code></td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>3.1.4<br>
      </td>
      <td>Variable naming follows a consistent style.</td>
      <td>Be consistent throughout the file about the naming convention
you are using:<br>
      <ul>
        <li style="font-family: monospace;">VariableName</li>
        <li style="font-family: monospace;">variableName<br>
        </li>
        <li style="font-family: monospace;">variablename</li>
        <li><span style="font-family: monospace;">variable_name</span></li>
      </ul>
      <span style="font-family: monospace;"></span></td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>3.1.5<br>
      </td>
      <td>No variable name mismatch.<br>
      </td>
      <td>Check that you have used correct variable names throughout
the file. Common errors are:<br>
      <ul>
        <li>Using <span style="font-family: monospace;">$1</span>
instead of <span style="font-family: monospace;">$i</span></li>
        <li>Confusing naming conventions, e.g. <span
 style="font-family: monospace;">$variableName</span>, <span
 style="font-family: monospace;">$variablename</span> and <span
 style="font-family: monospace;">$variable_name</span>.<br>
        </li>
      </ul>
      </td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>3.1.6<br>
      </td>
      <td>Proper use of single and double quotes.</td>
      <td>Single quotes do not allow variable expansion and use of many
control characters.<br>
See <a href="http://www.php.net/manual/en/language.types.string.php">http://www.php.net/manual/en/language.types.string</a>
for exact details.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td style="background-color: rgb(204, 204, 255);"><br>
      </td>
      <td style="background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">3.2</span><br>
      </td>
      <td style="background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">Logic Errors</span><br>
      </td>
      <td style="background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>3.2.1<br>
      </td>
      <td>Variable declaration/initialisation before use.<br>
      </td>
      <td>Sometimes variables are declared
inside conditional statements, and when referenced elsewhere in the
file there is no guarantee that they will be initialized.&nbsp; It is
good practise to declare all you variables at the start of a method and
comment their purpose.<br>
      </td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>3.2.2<br>
      </td>
      <td>When
reading a file line by line inside a while loop the next line is
fetched before the end of the block. </td>
      <td> Otherwise you end up in an
infinite loop.</td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>3.2.3<br>
      </td>
      <td>Correct use of operators <span
 style="font-family: monospace;">&amp; </span>and <span
 style="font-family: monospace;">$$</span></td>
      <td>Normally when you assign a variable, the result of the RHS is
      <span style="font-style: italic;">copied </span>into the
variable on the LHS. When you assign a variable using the <span
 style="font-family: monospace;">&amp;</span> operator, you are <span
 style="font-style: italic;">assigning by reference</span>. See <a
 href="http://www.php.net/manual/en/language.variables.php">http://www.php.net/manual/en/language.variables</a>
for details.<br>
      <br>
The <span style="font-family: monospace;">$$</span> syntax allows you
to reference a variable whose name is not known until run time. For
example:<br>
      <pre>&nbsp;$x = "foo";<br>&nbsp;echo $$x;</pre>
would print the content of the variable <span
 style="font-family: monospace;">$foo</span>. See <a
 href="http://www.php.net/manual/en/language.variables.variable.php">http://www.php.net/manual/en/language.variables.variable</a><br>
      </td>
    </tr>
    <tr>
      <td>Opt<br>
      </td>
      <td>3.2.4<br>
      </td>
      <td><tt>include_once</tt> and <tt>require_once</tt>
in preference to <tt>include</tt> and <tt>require</tt>.</td>
      <td><code><i><br>
      </i> </code></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td style="background-color: rgb(204, 204, 255);"><br>
      </td>
      <td style="background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">3.3</span><br>
      </td>
      <td style="background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">Documentation Errors</span><br>
      </td>
      <td style="background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>3.3.1<br>
      </td>
      <td>Comments include what the code does <em>and</em> why.</td>
      <td>Assume that whoever is reading your code has no idea of how
the underlying framework/functions operate. It's also good to have an
explanation of why any choices were adopted over others so that future
developers aren't tempted to 'improve' your code.<br>
      </td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>3.3.2<br>
      </td>
      <td>Proper use of FIXME and TODO.<br>
      </td>
      <td>FIXME is for broken code, TODO is for incomplete code.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">3.4<br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">Portability<br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td>Req<br>
      </td>
      <td>3.4.1<br>
      </td>
      <td>Use <span style="font-family: monospace;">&lt;?</span><a
 style="text-decoration: none; font-family: monospace;" title="PHP"
 href="http://www.php.net">php</a> in
preference of <span style="font-family: monospace;">&lt;?</span><br>
      </td>
      <td><span style="font-family: monospace;">&lt;?php</span> is more
portable.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
  </tbody>
</table>
<h2>4 Common Databases Errors<br>
</h2>
<table border="1">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);"><span
 style="font-weight: bold;">BK</span><br>
      </td>
      <td
 style="vertical-align: top; text-align: center; background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);">#<br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; text-align: center; background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);">Description<br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; text-align: center; background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);">Explanation<br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">4.1<br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">Security<br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">4.1.1<br>
      </td>
      <td style="vertical-align: top;">Correct quoting of variables
before database storage.<br>
      </td>
      <td style="vertical-align: top;">The recommended method of
quoting variables is to use bind variables method like so:<br>
      <pre>$query = 'select xar_name, ? as notes from xar_table where<span
 class="toowide"> xar_id = ?';</span><br>          $dbconn-&gt;Execute($query, array($notes, $id));</pre>
See also <a href="http://bugs.xaraya.com/show_bug.cgi?id=2275">bug 2275</a>
and <a
 href="http://www.xaraya.com/documentation/rfcs/rfc0045.html#rfc.section.6">RFC
45 Section 6</a>.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">4.2<br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">Portability<br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">4.2.1<br>
      </td>
      <td style="vertical-align: top;">Don't hard code primary keys in
insert statements!<br>
      </td>
      <td style="vertical-align: top;">This causes problems with
portability. The correct method is to use adodb's GenId() to generate a
primary key. e.g.<br>
      <pre>&nbsp;&nbsp; $nextId = $dbconn-&gt;GenId("tablename");<br>   $query = "INSERT INTO tablename VALUES ($nextId, 'Value')";<br></pre>
See also <a href="http://bugs.xaraya.com/show_bug.cgi?id=486">bug 486</a>.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">4.2.2<br>
      </td>
      <td style="vertical-align: top;">All columns prefixed with <span
 style="font-family: monospace;">xar_</span><br>
      </td>
      <td style="vertical-align: top;">This is to avoid clashes with
reserved names. e.g the word 'position' is reserved in PostgreSQL.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">4.2.3<br>
      </td>
      <td style="vertical-align: top;">Be consistent with case matching.<br>
      </td>
      <td style="vertical-align: top;">If you <span
 style="font-family: monospace;">INSERT</span> a value in lowercase,
make sure you <span style="font-family: monospace;">SELECT</span> it
in lowercase also. MySQL does case insensitive matching, but not all
other databases do.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">4.2.4<br>
      </td>
      <td style="vertical-align: top;">Correct types when creating
database fields.<br>
      </td>
      <td style="vertical-align: top;">Valid types are <span
 style="font-style: italic;">TODO: valid types</span><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">4.3<br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; background-color: rgb(204, 204, 255);">Performance<br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">4.3.1<br>
      </td>
      <td style="vertical-align: top;">Indexes are added on primary and
foreign keys, and fields which have explicit sorting clauses.<br>
      </td>
      <td style="vertical-align: top;">Indexing improves the speed of
your database queries. See the <span style="font-family: monospace;">example</span>
module for examples of creating an index using <span
 style="font-family: monospace;">xarDBCreateIndex()</span>.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Opt?<br>
      </td>
      <td style="vertical-align: top;">4.3.2<br>
      </td>
      <td style="vertical-align: top;">Assign database objects by
reference.<br>
      </td>
      <td style="vertical-align: top;">Adodb database objects are
large, and you can save memory space by assigning them by reference:<br>
      <pre>   $dbconn =&amp; xarDBGetConn();<br>   $result =&amp; $dbconn-&gt;Execute("some sql");<br></pre>
      </td>
    </tr>
  </tbody>
</table>
<span></span>
<h2>5 Coding Standards</h2>
<table border="1">
  <tbody>
    <tr>
      <td
 style="background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);"><span
 style="font-weight: bold;">BK</span><br>
      </td>
      <td
 style="vertical-align: top; text-align: center; background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);">#<br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; text-align: center; background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);">Description<br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; text-align: center; background-color: rgb(51, 0, 153); color: rgb(255, 255, 255);">Explanation<br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">5.1</span><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">Commenting</span><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>5.1.1<br>
      </td>
      <td>Standard file header.</td>
      <td>See <a
 href="http://www.xaraya.com/documentation/rfcs/rfc0044.html#rfc.section.3">RFC
44 section 3</a>.</td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>5.1.2<br>
      </td>
      <td>Function header.</td>
      <td>See <a
 href="http://www.xaraya.com/documentation/rfcs/rfc0044.html#rfc.section.3">RFC
44 section 3</a>.</td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>5.1.3<br>
      </td>
      <td>Classes have the standard header.</td>
      <td>See <a
 href="http://www.xaraya.com/documentation/rfcs/rfc0044.html#rfc.section.3">RFC
44 section 3</a>.<br>
      </td>
    </tr>
    <tr>
      <td>Opt<br>
      </td>
      <td>5.1.4<br>
      </td>
      <td>Avoid use of Perl/shell comments.</td>
      <td><code><br>
      </code></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">5.2</span><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">Formatting</span><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Req<br>
      </td>
      <td style="vertical-align: top;">5.2.1<br>
      </td>
      <td style="vertical-align: top;">No use of tabs.</td>
      <td style="vertical-align: top;">Different editors render tabs
differently.<br>
      </td>
    </tr>
    <tr>
      <td>Opt<br>
      </td>
      <td>5.2.2<br>
      </td>
      <td>Indent is 4 spaces.</td>
      <td><code></code><br>
      </td>
    </tr>
    <tr>
      <td>Opt?<br>
      </td>
      <td>5.2.3<br>
      </td>
      <td>Use structural indentation, not visual.</td>
      <td>See <a
 href="http://www.xaraya.com/documentation/rfcs/rfc0044.html#rfc.section.4.1">RFC
44 section 4.1</a>.<br>
      </td>
    </tr>
    <tr>
      <td>Req<br>
      </td>
      <td>5.2.4<br>
      </td>
      <td>Use unix file and line endings.</td>
      <td><br>
      </td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>5.2.5<br>
      </td>
      <td>Correct use of whitespace in function calls.</td>
      <td>See <a
 href="http://www.xaraya.com/documentation/rfcs/rfc0044.html#rfc.section.4.2">RFC
44 section 4.2</a>. An example of the standard syntax is<br>
      <pre>$var = foo($bar, $baz, $quux);</pre>
      </td>
    </tr>
    <tr>
      <td>Req<br>
      </td>
      <td>5.2.6<br>
      </td>
      <td>Function and class declarations use the 'one true brace'
convention.</td>
      <td>Braces after function and class declarations appear on a new
line.<code></code></td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>5.2.7<br>
      </td>
      <td>Arguments with default values go at end of
parameter list.</td>
      <td>This reduces the number of required arguments.</td>
    </tr>
    <tr>
      <td>Req<br>
      </td>
      <td>5.2.8<br>
      </td>
      <td>No trailing newline at end of file.</td>
      <td><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">5.2.9<br>
      </td>
      <td style="vertical-align: top;">No other characters than ?&gt;
at the end of php file<br>
      </td>
      <td style="vertical-align: top;">Whitespace and other characters
accidentally inserted after the ?&gt; make the patches messy.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">5.3</span><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">Naming</span><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Req?<br>
      </td>
      <td style="vertical-align: top;">5.3.1<br>
      </td>
      <td style="vertical-align: top;">Function name matches filename.<br>
      </td>
      <td style="vertical-align: top;">E.g.&nbsp; The function <span
 style="font-family: monospace;">mymodule_adminapi_create()</span>
should exist in <span style="font-family: monospace;">mymodule/adminapi.php</span>
or <span style="font-family: monospace;">mymodule/adminapi/create.php</span>.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Req?<br>
      </td>
      <td style="vertical-align: top;">5.3.2<br>
      </td>
      <td style="vertical-align: top;">Use only lowercase filenames
matching [a-z_-.]*<br>
      </td>
      <td style="vertical-align: top;">For portability.<br>
      </td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>5.3.3<br>
      </td>
      <td>Correct function naming.</td>
      <td>
      <ol>
        <li>public functions start with "<span
 style="font-family: monospace;">xar</span>"</li>
        <li>protected functions start with "<span
 style="font-family: monospace;">xarFoo_</span>" (one underscore)</li>
        <li>private functions start with "<span
 style="font-family: monospace;">xarFoo__</span>" (two underscores)</li>
      </ol>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">5.3.4<br>
      </td>
      <td style="vertical-align: top;">Privilege masks match the level
of the privilege.<br>
      </td>
      <td style="vertical-align: top;">For example, a privilege for <span
 style="font-family: monospace;">ACCESS_OVERVIEW</span> would be named <span
 style="font-family: monospace;">SomethingView</span>; <span
 style="font-family: monospace;">ACCESS_READ</span> becomes <span
 style="font-family: monospace;">SomethingRead</span>; and so forth.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">5.4</span><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><span
 style="font-weight: bold;">Templates</span><br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(204, 204, 255);"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Opt?<br>
      </td>
      <td style="vertical-align: top;">5.4.1<br>
      </td>
      <td style="vertical-align: top;">Page templates begin with <span
 style="font-family: monospace;">&lt;xar:blocklayout&gt;</span> tag.
This is for templates in <span style="font-family: monospace;">themes/&lt;yourtheme&gt;/pages</span>
only.<br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">&lt;xar:blocklayout
version="1.0" content="text/html" xmlns:xar=<a
 class="moz-txt-link-rfc2396E" href="http://xaraya.com/2004/blocklayout">"http://xaraya.com/2004/blocklayout"</a>&gt;</td>
    </tr>
    <tr>
      <td>Req?<br>
      </td>
      <td>5.4.2<br>
      </td>
      <td>Minimize php usage in templates.</td>
      <td>PHP usage in blocklayout templates might be dissallowed in
the future, as it leads to all kinds of problems (security related
mostly). <span style="font-style: italic;">I don't think this is even
possible anymore?</span><br>
      </td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>5.4.3<br>
      </td>
      <td>Templates are self-containable.</td>
      <td>See <a
 href="http://www.xaraya.com/documentation/rfcs/rfc0044.html#rfc.section.2">RFC
44 section 2</a>.<br>
      </td>
    </tr>
    <tr>
      <td>Opt?<br>
      </td>
      <td>5.4.4<br>
      </td>
      <td>Use <span style="font-family: monospace;">$</span> signs for
variables inside template <span style="font-family: monospace;">#..#</span>
for variables.</td>
      <td><code><br>
      </code></td>
    </tr>
    <tr>
      <td><br>
      </td>
      <td>5.4.5<br>
      </td>
      <td>Common code in templates separated and included
using <span style="font-family: monospace;">&lt;xar:template /&gt;</span></td>
      <td>Maximize reuse.<br>
      </td>
    </tr>
    <tr>
      <td>Opt?<br>
      </td>
      <td>5.4.6<br>
      </td>
      <td>License included.</td>
      <td><code></code>
      <pre>&lt;xar:comment&gt; License: GPL http://www.gnu.org/copyleft/gpl.html <span
 class="toowide">&lt;/xar:comment&gt;<span style="font-style: italic;"><br></span></span><span
 class="toowide"><span style="font-style: italic;"></span></span></pre>
      <code> </code></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">5.4.7<br>
      </td>
      <td style="vertical-align: top;">Avoid using inline styles for
common output.<br>
      </td>
      <td style="vertical-align: top;">The <a
 href="http://docs.xaraya.com/docs/rfcs/rfc0048.html">Xaraya Style Guide</a>
defines a number of classes to make your templates have consistent look
and feel as the rest of Xaraya.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Opt?<br>
      </td>
      <td style="vertical-align: top;">5.4.8<br>
      </td>
      <td style="vertical-align: top;">Use <span
 style="font-family: monospace;">&amp;amp;</span> for the ampersand
character.<br>
      </td>
      <td style="vertical-align: top;">Templates are XML documents
themselves, so if you want an ampersand character (for example, in a
url) you need to use <span style="font-family: monospace;">&amp;amp;</span><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;">5.4.9<br>
      </td>
      <td style="vertical-align: top;">No use of <span
 style="font-family: monospace;">---&gt;</span> for comments<br>
      </td>
      <td style="vertical-align: top;">This is actually invalid XML,
use &lt;xar:comment&gt; instead.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
* Only for the core.<br>
<br>
</body>
</html>
